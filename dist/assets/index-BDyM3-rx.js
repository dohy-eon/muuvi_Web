import{j as e}from"./index-isNbCbEh.js";import{u as se,f as ae,a as h}from"./react-vendor-BCvJ4SZV.js";import{B as re}from"./BottomNavigation-BaosoDGv.js";import{g as le,b as ne}from"./search-tk8JA4ss.js";import"./supabase-vendor-DMkEyeru.js";import"./recoil-vendor-DrCo3c3K.js";function fe(){const P=se(),{type:c,id:n}=ae(),[l,C]=h.useState(null),[j,v]=h.useState(!0),[E,y]=h.useState(null),[w,b]=h.useState(null),[N,i]=h.useState([]),[d,T]=h.useState([]),[R,V]=h.useState(null),[M,D]=h.useState(null),[u,I]=h.useState([]),[S,q]=h.useState([]),[g,G]=h.useState(null);h.useEffect(()=>{let t=!0;return(async()=>{var a,r,o,_,K,O,F;if(!(!c||!n))try{const $=await le(c,n);if(t){C($);const te=$.genres??[];if(i(te),c==="movie"){const x=(r=(a=$.release_dates)==null?void 0:a.results)==null?void 0:r.find(f=>f.iso_3166_1==="KR"),p=((_=(o=x==null?void 0:x.release_dates)==null?void 0:o[0])==null?void 0:_.certification)||null;y(p||null);const m=$.runtime;if(m){const f=Math.floor(m/60),s=m%60;b(f>0?`${f}시간 ${s}분`:`${s}분`)}else b(null)}else{const x=((K=$.content_ratings)==null?void 0:K.results)||[],p=x.find(s=>s.iso_3166_1==="KR");let m=(p==null?void 0:p.rating)||null;if(!m){const s=x.find(k=>k.iso_3166_1==="US");m=(s==null?void 0:s.rating)||null,m||(m=((O=x==null?void 0:x[0])==null?void 0:O.rating)||null)}y(m);const f=(F=$.episode_run_time)==null?void 0:F[0];if(f){const s=Math.floor(f/60),k=f%60;b(s>0?`${s}시간 ${k}분`:`${k}분`)}else b(null)}const z=$.credits;if(z){const x=(z.cast||[]).slice(0,6).map(s=>{var k,J;return{id:s.id,name:s.name||"",character:s.character||((J=(k=s.roles)==null?void 0:k[0])==null?void 0:J.character)||"",profile_path:s.profile_path?`https://image.tmdb.org/t/p/w185${s.profile_path}`:null}});T(x);const p=z.crew||[],m=p.find(s=>s.job==="Director")||p.find(s=>s.department==="Directing")||(c==="tv"?p.find(s=>s.job==="Executive Producer"):void 0);V((m==null?void 0:m.name)??null);let f=p.find(s=>s.job==="Writer")||p.find(s=>s.job==="Screenplay")||p.find(s=>s.job==="Story")||p.find(s=>s.job==="Novel")||(c==="tv"?p.find(s=>s.job==="Creator"):void 0);if(!f&&c==="tv"){const s=$.created_by;Array.isArray(s)&&s.length>0?D(s.map(k=>k.name).filter(Boolean).join(", ")):D(null)}else D((f==null?void 0:f.name)??null)}oe(c,n).then(x=>t&&I(x)),ie(c,n).then(x=>t&&q(x))}}finally{}})(),()=>{t=!1}},[c,n]);const A=l&&("title"in l?l.title:l.name)||"상세",U=(()=>{var t,a;return l?"release_date"in l?((t=l.release_date)==null?void 0:t.slice(0,4))||"":((a=l.first_air_date)==null?void 0:a.slice(0,4))||"":""})(),B=ne(l&&l.poster_path),H=g?S.filter(t=>t.type===g):S,Q=S.filter(t=>t.type==="flatrate").length,X=S.filter(t=>t.type==="free").length,Y=S.filter(t=>t.type==="rent").length,Z=S.filter(t=>t.type==="buy").length,ee=(()=>{const t={flatrate:0,free:1,rent:2,buy:3},a=new Map;for(const r of S){const o=a.get(r.provider_id);o?t[r.type]<t[o.type]&&a.set(r.provider_id,r):a.set(r.provider_id,r)}return Array.from(a.values())})(),W=g?H:ee,L=h.useCallback(t=>{G(a=>a===t?null:t)},[]);return h.useEffect(()=>{v(!!B)},[B]),e.jsxs("div",{className:"w-full h-screen bg-white relative font-pretendard overflow-hidden",children:[e.jsxs("div",{className:"h-full overflow-y-auto bg-white",children:[e.jsx("button",{onClick:()=>P(-1),className:"absolute top-[20px] left-5 z-20 w-6 h-6 flex items-center justify-center","aria-label":"뒤로가기",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`w-6 h-6 ${j?"text-white":"text-black"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})})}),e.jsxs("div",{className:"relative w-full h-[378px] overflow-hidden",children:[B&&e.jsxs(e.Fragment,{children:[e.jsx("img",{src:B,alt:A,className:"absolute inset-0 w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-black/0 to-black"})]}),e.jsxs("div",{className:"absolute inset-0 flex flex-col justify-end pb-4 px-5",children:[e.jsx("h1",{className:"text-[20px] font-bold text-white mb-1 text-center",children:A}),e.jsxs("p",{className:"text-[14px] font-normal text-white text-center mb-4",children:[c==="movie"?"영화":"TV"," • ",U]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[W.slice(0,2).map((t,a)=>e.jsx("div",{className:"w-5 h-5 rounded-[6px] overflow-hidden",children:t.logo_path?e.jsx("img",{src:t.logo_path,alt:t.provider_name,className:"w-full h-full object-cover",onError:r=>{const o=r.target;o.style.display="none"}}):e.jsx("div",{className:"w-full h-full bg-gray-400"})},t.provider_id||a)),N.slice(0,2).map(t=>e.jsx("div",{className:"h-5 bg-[#9b59b6] rounded-[6px] px-2 flex items-center justify-center",children:e.jsx("span",{className:"text-[10px] font-normal text-white whitespace-nowrap",children:t.name})},t.id))]}),B&&e.jsx("div",{className:"absolute right-[20px] bottom-[20px] w-[84px] h-[120px] rounded-[6px] overflow-hidden",children:e.jsx("img",{src:B,alt:`${A} poster`,className:"w-full h-full object-cover"})})]})]}),(l==null?void 0:l.overview)&&e.jsx("div",{className:"w-full min-h-[105px] bg-[#010100] px-5 py-4",children:e.jsx("p",{className:"text-[14px] font-normal text-white leading-[1.5]",children:l.overview})}),e.jsx("div",{className:"mx-5 mt-5 mb-6 border border-black/10 rounded-[20px] px-4 py-4",children:e.jsxs("div",{className:"space-y-[15px]",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx("p",{className:"text-[14px] font-normal text-gray-700 w-[93px]",children:"원제"}),e.jsx("p",{className:"text-[14px] font-normal text-gray-900 flex-1",children:A})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("p",{className:"text-[14px] font-normal text-gray-700 w-[93px]",children:"장르"}),e.jsx("p",{className:"text-[14px] font-normal text-gray-900 flex-1",children:N.map(t=>t.name).join(", ")||"-"})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("p",{className:"text-[14px] font-normal text-gray-700 w-[93px]",children:"개봉일"}),e.jsx("p",{className:"text-[14px] font-normal text-gray-900 flex-1",children:U?`${U}년`:"-"})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("p",{className:"text-[14px] font-normal text-gray-700 w-[93px]",children:"연령등급"}),e.jsx("p",{className:"text-[14px] font-normal text-gray-900 flex-1",children:E||"-"})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("p",{className:"text-[14px] font-normal text-gray-700 w-[93px]",children:"러닝타임"}),e.jsx("p",{className:"text-[14px] font-normal text-gray-900 flex-1",children:w||"-"})]})]})}),e.jsxs("div",{className:"px-5 mb-6",children:[e.jsx("h2",{className:"text-[16px] font-bold text-black mb-4",children:"보러가기"}),e.jsxs("div",{className:"flex items-center gap-6 mb-4",children:[e.jsxs("button",{onClick:()=>L("flatrate"),className:`flex flex-col items-center gap-1 ${g==="flatrate"?"opacity-100":"opacity-60"} hover:opacity-100 transition-opacity`,children:[e.jsxs("p",{className:"text-[16px] font-normal text-black",children:["정액제 ",Q]}),e.jsx("div",{className:`w-[55px] h-[2px] border-b ${g==="flatrate"?"border-[#2e2c6a]":"border-transparent"}`})]}),e.jsxs("button",{onClick:()=>L("free"),className:`flex flex-col items-center gap-1 ${g==="free"?"opacity-100":"opacity-60"} hover:opacity-100 transition-opacity`,children:[e.jsxs("p",{className:"text-[16px] font-normal text-black",children:["무료 ",X]}),e.jsx("div",{className:`w-[55px] h-[1px] border-b ${g==="free"?"border-[#2e2c6a]":"border-transparent"}`})]}),e.jsxs("button",{onClick:()=>L("rent"),className:`flex flex-col items-center gap-1 ${g==="rent"?"opacity-100":"opacity-60"} hover:opacity-100 transition-opacity`,children:[e.jsxs("p",{className:"text-[16px] font-normal text-black",children:["대여 ",Y]}),e.jsx("div",{className:`w-[55px] h-[1px] border-b ${g==="rent"?"border-[#2e2c6a]":"border-transparent"}`})]}),e.jsxs("button",{onClick:()=>L("buy"),className:`flex flex-col items-center gap-1 ${g==="buy"?"opacity-100":"opacity-60"} hover:opacity-100 transition-opacity`,children:[e.jsxs("p",{className:"text-[16px] font-normal text-black",children:["구매 ",Z]}),e.jsx("div",{className:`w-[55px] h-[1px] border-b ${g==="buy"?"border-[#2e2c6a]":"border-transparent"}`})]})]}),e.jsx("div",{className:"space-y-3",children:W.length>0?W.map((t,a)=>e.jsxs("button",{className:"w-full h-9 border border-[#2e2c6a] rounded-[12px] flex items-center justify-between px-2 hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[t.logo_path&&e.jsx("div",{className:"w-5 h-5 rounded-[6px] overflow-hidden",children:e.jsx("img",{src:t.logo_path,alt:t.provider_name,className:"w-full h-full object-cover",onError:r=>{const o=r.target;o.style.display="none"}})}),e.jsx("span",{className:"text-[14px] font-normal text-[#2e2c6a]",children:t.provider_name})]}),e.jsx("svg",{className:"w-4 h-4 text-[#2e2c6a] rotate-180",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})]},t.provider_id||a)):e.jsx("p",{className:"text-[14px] font-normal text-gray-500 text-center py-4",children:g?"해당 타입으로 시청 가능한 플랫폼이 없습니다.":"시청 가능한 플랫폼이 없습니다."})})]}),e.jsxs("div",{className:"px-5 mb-6",children:[e.jsx("h2",{className:"text-[16px] font-semibold text-black mb-4",children:"출연진/제작진"}),d.length>0?e.jsx("div",{className:"grid grid-cols-3 gap-x-4 gap-y-4 mb-4",children:d.map(t=>e.jsxs("div",{className:"flex flex-col items-center min-w-0 max-w-[100px] mx-auto",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-gray-300 mb-2 overflow-hidden flex items-center justify-center flex-shrink-0",children:t.profile_path?e.jsx("img",{src:t.profile_path,alt:t.name,className:"w-full h-full object-cover",onError:a=>{const r=a.target;r.style.display="none"}}):null}),e.jsx("div",{className:"bg-gray-900 rounded-[10px] px-1.5 py-0.5 mb-1 w-full min-w-0",children:e.jsx("span",{className:"text-[14px] font-normal text-white block truncate text-center",title:t.character||"출연",children:t.character||"출연"})}),e.jsx("span",{className:"text-[14px] font-normal text-gray-900 text-center w-full truncate block min-w-0",title:t.name,children:t.name})]},t.id))}):e.jsx("div",{className:"text-[14px] font-normal text-gray-500 text-center py-4",children:"출연진 정보가 없습니다."}),e.jsx("div",{className:"w-full h-[1px] border-t border-[#2e2c6a] my-4"}),e.jsxs("div",{className:"space-y-4",children:[R&&e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("span",{className:"text-[16px] font-normal text-black flex-shrink-0",children:"감독"}),e.jsx("span",{className:"text-[16px] font-normal text-[#7a8dd6] flex-1 truncate",title:R,children:R})]}),M&&e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("span",{className:"text-[16px] font-normal text-black flex-shrink-0",children:"극본"}),e.jsx("span",{className:"text-[16px] font-normal text-[#7a8dd6] flex-1 truncate",title:M,children:M})]}),!R&&!M&&e.jsx("div",{className:"text-[14px] font-normal text-gray-500",children:"제작진 정보가 없습니다."})]}),e.jsx("button",{className:"w-full h-[52px] bg-[#2e2c6a] rounded-[10px] mt-6 flex items-center justify-center",children:e.jsx("span",{className:"text-[16px] font-semibold text-white",children:"출연진/제작진 더보기"})})]}),e.jsxs("div",{className:"px-5 mb-6",children:[e.jsx("h2",{className:"text-[16px] font-semibold text-black mb-4",children:"영상 및 포스터 콜라주"}),u.length>0?e.jsxs("div",{className:"space-y-3",children:[u.length>0&&e.jsxs("div",{className:"flex gap-3",children:[u.slice(0,2).map((t,a)=>{const r=[300,190];return e.jsxs("div",{className:"h-32 rounded overflow-hidden cursor-pointer relative group",style:{width:`${r[a]}px`},onClick:()=>{t.type,window.open(t.url,"_blank")},children:[e.jsx("img",{src:t.thumbnail,alt:t.type==="video"?"비디오":"포스터",className:"w-full h-full object-cover",onError:o=>{const _=o.target;_.src="",_.style.backgroundColor="#d1d5db"}}),t.type==="video"&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/30 group-hover:bg-black/50 transition-colors",children:e.jsx("svg",{className:"w-10 h-10 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M6.3 2.841A1.5 1.5 0 004 4.11V15.89a1.5 1.5 0 002.3 1.269l9.344-5.89a1.5 1.5 0 000-2.538L6.3 2.84z"})})})]},a)}),u.length<2&&e.jsx("div",{className:"h-32 w-[190px] bg-gray-300 rounded"})]}),u.length>2&&e.jsxs("div",{className:"flex gap-3",children:[u.slice(2,4).map((t,a)=>e.jsxs("div",{className:"h-32 w-[210px] rounded overflow-hidden cursor-pointer relative group",style:{width:"210px"},onClick:()=>{t.type,window.open(t.url,"_blank")},children:[e.jsx("img",{src:t.thumbnail,alt:t.type==="video"?"비디오":"포스터",className:"w-full h-full object-cover",onError:r=>{const o=r.target;o.src="",o.style.backgroundColor="#d1d5db"}}),t.type==="video"&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/30 group-hover:bg-black/50 transition-colors",children:e.jsx("svg",{className:"w-10 h-10 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M6.3 2.841A1.5 1.5 0 004 4.11V15.89a1.5 1.5 0 002.3 1.269l9.344-5.89a1.5 1.5 0 000-2.538L6.3 2.84z"})})})]},a+2)),u.length<4&&e.jsx("div",{className:"h-32 w-[210px] bg-gray-300 rounded"})]}),u.length>4&&e.jsxs("div",{className:"flex gap-3",children:[u.slice(4,7).map((t,a)=>{const r=[144,147,188];return e.jsxs("div",{className:"h-32 rounded overflow-hidden cursor-pointer relative group",style:{width:`${r[a]}px`},onClick:()=>{t.type,window.open(t.url,"_blank")},children:[e.jsx("img",{src:t.thumbnail,alt:t.type==="video"?"비디오":"포스터",className:"w-full h-full object-cover",onError:o=>{const _=o.target;_.src="",_.style.backgroundColor="#d1d5db"}}),t.type==="video"&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/30 group-hover:bg-black/50 transition-colors",children:e.jsx("svg",{className:"w-8 h-8 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M6.3 2.841A1.5 1.5 0 004 4.11V15.89a1.5 1.5 0 002.3 1.269l9.344-5.89a1.5 1.5 0 000-2.538L6.3 2.84z"})})})]},a+4)}),u.length<7&&e.jsxs(e.Fragment,{children:[u.length===5&&e.jsx("div",{className:"h-32 w-[147px] bg-gray-300 rounded"}),u.length===6&&e.jsx("div",{className:"h-32 w-[188px] bg-gray-300 rounded"})]})]})]}):e.jsx("div",{className:"text-[14px] font-normal text-gray-500 text-center py-4",children:"영상 및 포스터 정보가 없습니다."})]})]}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 z-30 pt-4 pb-2 pointer-events-none",children:e.jsx("div",{className:"pointer-events-auto",children:e.jsx(re,{})})})]})}async function ie(P,c){const n="69a6ef89f280454b2aab653333314c3d",l=P==="movie"?"movie":"tv",C=new URL(`https://api.themoviedb.org/3/${l}/${c}/watch/providers`);n.startsWith("eyJ")||C.searchParams.set("api_key",n);const j=await fetch(C.toString(),{headers:n.startsWith("eyJ")?{Authorization:`Bearer ${n}`}:void 0}).catch(()=>null);if(!j||!j.ok)return[];const v=await j.json(),y=["KR","US","JP"].find(N=>{var i;return(i=v==null?void 0:v.results)==null?void 0:i[N]}),w=y?v.results[y]:null;if(!w)return[];const b=[];return["flatrate","free","rent","buy"].forEach(N=>{const i=w[N];Array.isArray(i)&&i.forEach(d=>{b.push({provider_id:d.provider_id,provider_name:d.provider_name,logo_path:d.logo_path?`https://image.tmdb.org/t/p/w300${d.logo_path}`:void 0,type:N})})}),b}async function oe(P,c){const n="69a6ef89f280454b2aab653333314c3d",l=P==="movie"?"movie":"tv",C=n.startsWith("eyJ")?{Authorization:`Bearer ${n}`}:void 0,j=new URL(`https://api.themoviedb.org/3/${l}/${c}/videos`),v=new URL(`https://api.themoviedb.org/3/${l}/${c}/images`);j.searchParams.set("language","ko-KR"),n.startsWith("eyJ")||(j.searchParams.set("api_key",n),v.searchParams.set("api_key",n));const[E,y]=await Promise.all([fetch(j.toString(),{headers:C}).catch(()=>null),fetch(v.toString(),{headers:C}).catch(()=>null)]),w=[];if(E&&E.ok&&((await E.json()).results||[]).filter(i=>i.type==="Trailer"||i.type==="Teaser"||i.type==="Clip").slice(0,3).forEach(i=>{i.key&&w.push({type:"video",url:`https://www.youtube.com/watch?v=${i.key}`,thumbnail:`https://img.youtube.com/vi/${i.key}/hqdefault.jpg`})}),y&&y.ok){const b=await y.json();(b.backdrops||[]).slice(0,4).forEach(d=>{d.file_path&&w.push({type:"image",url:`https://image.tmdb.org/t/p/original${d.file_path}`,thumbnail:`https://image.tmdb.org/t/p/w500${d.file_path}`})}),(b.posters||[]).slice(0,2).forEach(d=>{d.file_path&&w.push({type:"image",url:`https://image.tmdb.org/t/p/original${d.file_path}`,thumbnail:`https://image.tmdb.org/t/p/w500${d.file_path}`})})}return w.slice(0,9)}export{fe as default};
